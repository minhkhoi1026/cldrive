//{"idata":1,"matrixA":6,"memA":3,"memB":4,"memC":5,"odata":0,"width":2}
int hook(int argId, int id) {
	int gID = get_global_id(0);
	printf("%d,%d,%d\n", gID, argId, id);
	return id;
}
constant float matrixA[64] = {0.353553390593273730857504233426880091428756713867187500F, 0.353553390593273730857504233426880091428756713867187500F, 0.353553390593273730857504233426880091428756713867187500F, 0.353553390593273730857504233426880091428756713867187500F, 0.353553390593273730857504233426880091428756713867187500F, 0.353553390593273730857504233426880091428756713867187500F, 0.353553390593273730857504233426880091428756713867187500F, 0.353553390593273730857504233426880091428756713867187500F, 0.490392640201615215289621119154617190361022949218750000F, 0.415734806151272617835701339572551660239696502685546875F, 0.277785116509801144335511935423710383474826812744140625F, 0.097545161008064151797469776283833198249340057373046875F, -0.097545161008064096286318545026006177067756652832031250F, -0.277785116509800977802058241650229319930076599121093750F, -0.415734806151272673346852570830378681421279907226562500F, -0.490392640201615215289621119154617190361022949218750000F, 0.461939766255643369241568052530055865645408630371093750F, 0.191341716182544918645191955874906852841377258300781250F, -0.191341716182544863134040724617079831659793853759765625F, -0.461939766255643369241568052530055865645408630371093750F, -0.461939766255643369241568052530055865645408630371093750F, -0.191341716182545168445372496535128448158502578735351562F, 0.191341716182545001911918802761647384613752365112304688F, 0.461939766255643258219265590014401823282241821289062500F, 0.415734806151272617835701339572551660239696502685546875F, -0.097545161008064096286318545026006177067756652832031250F, -0.490392640201615215289621119154617190361022949218750000F, -0.277785116509801088824360704165883362293243408203125000F, 0.277785116509800922290907010392402298748493194580078125F, 0.490392640201615215289621119154617190361022949218750000F, 0.097545161008064387719862509129598038271069526672363281F, -0.415734806151272562324550108314724639058113098144531250F, 0.353553390593273786368655464684707112610340118408203125F, -0.353553390593273730857504233426880091428756713867187500F, -0.353553390593273841879806695942534133791923522949218750F, 0.353553390593273730857504233426880091428756713867187500F, 0.353553390593273841879806695942534133791923522949218750F, -0.353553390593273342279445614622090943157672882080078125F, -0.353553390593273619835201770911226049065589904785156250F, 0.353553390593273286768294383364263921976089477539062500F, 0.277785116509801144335511935423710383474826812744140625F, -0.490392640201615215289621119154617190361022949218750000F, 0.097545161008064137919681968469376442953944206237792969F, 0.415734806151272784369155033346032723784446716308593750F, -0.415734806151272562324550108314724639058113098144531250F, -0.097545161008064013019591698139265645295381546020507812F, 0.490392640201615326311923581670271232724189758300781250F, -0.277785116509800755757453316618921235203742980957031250F, 0.191341716182544918645191955874906852841377258300781250F, -0.461939766255643369241568052530055865645408630371093750F, 0.461939766255643258219265590014401823282241821289062500F, -0.191341716182544918645191955874906852841377258300781250F, -0.191341716182545279467674959050782490521669387817382812F, 0.461939766255643369241568052530055865645408630371093750F, -0.461939766255643147196963127498747780919075012207031250F, 0.191341716182544779867313877730339299887418746948242188F, 0.097545161008064151797469776283833198249340057373046875F, -0.277785116509801088824360704165883362293243408203125000F, 0.415734806151272784369155033346032723784446716308593750F, -0.490392640201615326311923581670271232724189758300781250F, 0.490392640201615215289621119154617190361022949218750000F, -0.415734806151272506813398877056897617876529693603515625F, 0.277785116509800755757453316618921235203742980957031250F, -0.097545161008064276697560046613943995907902717590332031F};

kernel void dct_separated(global float* odata, global float* idata, unsigned int width, local float* memA, local float* memB, local float* memC) {
  const unsigned int gIndex = get_global_id(1) * width + get_global_id(0);
  const unsigned int localIndex = get_local_id(1) * 9 + get_local_id(0);

  memA[hook(3, localIndex)] = matrixA[hook(6, get_local_id(1) * 8 + get_local_id(0))];
  memB[hook(4, localIndex)] = idata[hook(1, gIndex)];

  barrier(0x01);
  {
    float sum = 0;
    int i = 8;
    while (i--) {
      sum += memA[hook(3, get_local_id(1) * 9 + i)] * memB[hook(4, i * 9 + get_local_id(0))];
    }
    memC[hook(5, localIndex)] = sum;
  }
  barrier(0x01);
  {
    float sum = 0;
    int i = 8;
    while (i--) {
      sum += memC[hook(5, get_local_id(1) * 9 + i)] * memA[hook(3, get_local_id(0) * 9 + i)];
    }
    odata[hook(0, gIndex)] = sum;
  }
}